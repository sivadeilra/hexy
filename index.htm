<html>
    <head>
        <link href="style.css" rel="stylesheet">
        <script src="main.js"></script>

        <script type="x-shader/x-vertex" id="vertex-shader">
            precision highp float;

            attribute vec3 a_pos;

            varying vec2 v_pos;

            void main() {
                gl_Position = vec4(a_pos, 1.0);
                
                v_pos = vec2(a_pos);
            }
        </script>

        <script type="x-shader/x-fragment" id="fragment-shader">
            #version 100

            precision highp float;

            uniform vec2 u_mouse;

            varying vec2 v_pos;

            const float PI = 3.1415926538;
            const float TAU = (PI * 2.0);

            const float SIXTY = TAU / 6.0;

            const float SCALE = 5.0;
            const float THRESHOLD = 0.05;
            
            const float ONE_THIRD = 1.0 / 3.0;
            const float TWO_THIRDS = 2.0 / 3.0;

            const float SQRT2 = sqrt(2.0);

            vec2 rot(vec2 target, float angle) {
                return vec2(target.x * cos(angle) + target.y * sin(angle), target.x * -sin(angle) + target.y * cos(angle));
            }

            float wave(float value) { return abs(value - floor(value + 0.5)) * 2.0; }

            bool segmenter(float angle, float offset) {
                const float INV_THRESHOLD = 1.0 - THRESHOLD;

                vec2 pos = (rot(v_pos, angle) + vec2(0, offset)) * SCALE;

                bool within_even_base = wave(pos.y * 0.433) >= INV_THRESHOLD;
                bool within_even_phase = wave(pos.x) >= TWO_THIRDS;

                bool within_odd_base = wave(pos.y * 0.433 + 0.5) >= INV_THRESHOLD;
                bool within_odd_phase = wave(pos.x + 0.5) >= TWO_THIRDS;

                return (within_even_base && within_even_phase) || (within_odd_base && within_odd_phase);
            }

            void main() {
                // gl_FragColor = vec4(u_mouse.x, u_mouse.y, 1.0, 1.0);

                float dx = (u_mouse.x - v_pos.x) * 4.0;
                float dy = (u_mouse.y - v_pos.y) * 4.0;
                float d2 = 1.0 - (pow(dx, 2.0) + pow(dy, 2.0)) * 0.5;
                float highlight = d2;

                const float sixty = PI / 3.0;
                const float banding = 5.0;
                const float ratio = 0.95;

                // project current position along 60 degree angle
                float proj_x = v_pos.x * sin(sixty) + v_pos.y * cos(sixty);
                // float proj_x = v_pos.x +  v_pos.y * sin(sixty);


                // // do x stuff
                // float sx = proj_x * banding;
                // float xphase = sx - floor(sx);
                // float r = xphase < ratio ? 0.0 : 0.8;
                float r = 0.0;

                float sqrt2 = sqrt(2.0);

                // do y stuff
                float even_sy = v_pos.y * banding * sqrt2;
                float even_yphase = even_sy - floor(even_sy);
                bool even_is_in_vertical = even_yphase >= ratio;

                float even_sx = v_pos.x * banding;
                float even_xphase = even_sx - floor(even_sx);
                bool even_is_in_segment = even_xphase >= 0.6666;

                bool even_on = even_is_in_segment && even_is_in_vertical;

                // do the odds
                // do y stuff
                float odd_sy = (v_pos.y + 0.5) * banding * sqrt2;
                float odd_yphase = odd_sy - floor(odd_sy);
                bool odd_is_in_vertical = odd_yphase >= ratio;

                float odd_sx = (v_pos.x + 0.5) * banding;
                float odd_xphase = odd_sx - floor(odd_sx);
                bool odd_is_in_segment = odd_xphase >= 0.707;

                bool odd_on = odd_is_in_segment && odd_is_in_vertical;

                bool any_on = even_on || odd_on;
                float g = any_on ? 1.0 : 0.0;

                //*
                gl_FragColor = vec4(
                    float(segmenter(0.0, 0.5)),
                    float(segmenter(SIXTY, 0.5)),
                    float(segmenter(2.0 * SIXTY, 0.5)),
                    1.0
                ) + clamp(1.0 - (sqrt(v_pos.x * v_pos.x + v_pos.y * v_pos.y) * 50.0), 0.0, 0.25);
                /**/
            }
        </script>
    </head>

    <body>
        <canvas id="canvas">Your browser does not seem to support HTML canvas.</canvas>

        <br>

        <pre style="color: #ffffff;" id="text"></pre>
    </body>
</html>